<!doctype html>
<html>
 <head>            
  <style>/* Reworked by IntelliJ Team The MIT License (MIT) Copyright (c) JetBrains Adapted from https://github.com/sindresorhus/github-markdown-css The MIT License (MIT) Copyright (c) Sindre Sorhus &lt;sindresorhus@gmail.com&gt; (sindresorhus.com) Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. */ @font-face { font-family: octicons-anchor; src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAYcAA0AAAAACjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABMAAAABwAAAAca8vGTk9TLzIAAAFMAAAARAAAAFZG1VHVY21hcAAAAZAAAAA+AAABQgAP9AdjdnQgAAAB0AAAAAQAAAAEACICiGdhc3AAAAHUAAAACAAAAAj//wADZ2x5ZgAAAdwAAADRAAABEKyikaNoZWFkAAACsAAAAC0AAAA2AtXoA2hoZWEAAALgAAAAHAAAACQHngNFaG10eAAAAvwAAAAQAAAAEAwAACJsb2NhAAADDAAAAAoAAAAKALIAVG1heHAAAAMYAAAAHwAAACABEAB2bmFtZQAAAzgAAALBAAAFu3I9x/Nwb3N0AAAF/AAAAB0AAAAvaoFvbwAAAAEAAAAAzBdyYwAAAADP2IQvAAAAAM/bz7t4nGNgZGFgnMDAysDB1Ml0hoGBoR9CM75mMGLkYGBgYmBlZsAKAtJcUxgcPsR8iGF2+O/AEMPsznAYKMwIkgMA5REMOXicY2BgYGaAYBkGRgYQsAHyGMF8FgYFIM0ChED+h5j//yEk/3KoSgZGNgYYk4GRCUgwMaACRoZhDwCs7QgGAAAAIgKIAAAAAf//AAJ4nHWMMQrCQBBF/0zWrCCIKUQsTDCL2EXMohYGSSmorScInsRGL2DOYJe0Ntp7BK+gJ1BxF1stZvjz/v8DRghQzEc4kIgKwiAppcA9LtzKLSkdNhKFY3HF4lK69ExKslx7Xa+vPRVS43G98vG1DnkDMIBUgFN0MDXflU8tbaZOUkXUH0+U27RoRpOIyCKjbMCVejwypzJJG4jIwb43rfl6wbwanocrJm9XFYfskuVC5K/TPyczNU7b84CXcbxks1Un6H6tLH9vf2LRnn8Ax7A5WQAAAHicY2BkYGAA4teL1+yI57f5ysDNwgAC529f0kOmWRiYVgEpDgYmEA8AUzEKsQAAAHicY2BkYGB2+O/AEMPCAAJAkpEBFbAAADgKAe0EAAAiAAAAAAQAAAAEAAAAAAAAKgAqACoAiAAAeJxjYGRgYGBhsGFgYgABEMkFhAwM/xn0QAIAD6YBhwB4nI1Ty07cMBS9QwKlQapQW3VXySvEqDCZGbGaHULiIQ1FKgjWMxknMfLEke2A+IJu+wntrt/QbVf9gG75jK577Lg8K1qQPCfnnnt8fX1NRC/pmjrk/zprC+8D7tBy9DHgBXoWfQ44Av8t4Bj4Z8CLtBL9CniJluPXASf0Lm4CXqFX8Q84dOLnMB17N4c7tBo1AS/Qi+hTwBH4rwHHwN8DXqQ30XXAS7QaLwSc0Gn8NuAVWou/gFmnjLrEaEh9GmDdDGgL3B4JsrRPDU2hTOiMSuJUIdKQQayiAth69r6akSSFqIJuA19TrzCIaY8sIoxyrNIrL//pw7A2iMygkX5vDj+G+kuoLdX4GlGK/8Lnlz6/h9MpmoO9rafrz7ILXEHHaAx95s9lsI7AHNMBWEZHULnfAXwG9/ZqdzLI08iuwRloXE8kfhXYAvE23+23DU3t626rbs8/8adv+9DWknsHp3E17oCf+Z48rvEQNZ78paYM38qfk3v/u3l3u3GXN2Dmvmvpf1Srwk3pB/VSsp512bA/GG5i2WJ7wu430yQ5K3nFGiOqgtmSB5pJVSizwaacmUZzZhXLlZTq8qGGFY2YcSkqbth6aW1tRmlaCFs2016m5qn36SbJrqosG4uMV4aP2PHBmB3tjtmgN2izkGQyLWprekbIntJFing32a5rKWCN/SdSoga45EJykyQ7asZvHQ8PTm6cslIpwyeyjbVltNikc2HTR7YKh9LBl9DADC0U/jLcBZDKrMhUBfQBvXRzLtFtjU9eNHKin0x5InTqb8lNpfKv1s1xHzTXRqgKzek/mb7nB8RZTCDhGEX3kK/8Q75AmUM/eLkfA+0Hi908Kx4eNsMgudg5GLdRD7a84npi+YxNr5i5KIbW5izXas7cHXIMAau1OueZhfj+cOcP3P8MNIWLyYOBuxL6DRylJ4cAAAB4nGNgYoAALjDJyIAOWMCiTIxMLDmZedkABtIBygAAAA==) format('woff'); } body { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; font-family: Helvetica, Arial, freesans, sans-serif; font-size: 14px; line-height: 1.6; word-wrap: break-word; margin: 0 30px; } strong { font-weight: bold; } img { border: 0; } input { color: inherit; font: inherit; margin: 0; line-height: normal; } html input[disabled] { cursor: default; } input[type="checkbox"] { box-sizing: border-box; padding: 0; } body * { box-sizing: border-box; } input { font: 13px/1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; } a { text-decoration: none; } a:hover, a:active { text-decoration: underline; } hr { height: 1px; padding: 0; margin: 20px 0; border: 0 none; } hr:before { display: table; content: ""; } hr:after { display: table; clear: both; content: ""; } blockquote { margin: 0; } ul, ol { padding: 0; margin-top: 0; margin-bottom: 0; } ol ol, ul ol { list-style-type: lower-roman; } ul ul ol, ul ol ol, ol ul ol, ol ol ol { list-style-type: lower-alpha; } dd { margin-left: 0; } .octicon { font: normal normal normal 16px/1 octicons-anchor; display: inline-block; text-decoration: none; text-rendering: auto; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .octicon-link:before { content: '\f05c'; } .markdown-body &gt; *:first-child { margin-top: 0 !important; } .markdown-body &gt; *:last-child { margin-bottom: 0 !important; } .anchor { position: absolute; top: 0; left: 0; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; } .anchor:focus { outline: none; } h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; } h1 .octicon-link, h2 .octicon-link, h3 .octicon-link, h4 .octicon-link, h5 .octicon-link, h6 .octicon-link { display: none; color: #000; vertical-align: middle; } h1:hover .anchor, h2:hover .anchor, h3:hover .anchor, h4:hover .anchor, h5:hover .anchor, h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; } h1:hover .anchor .octicon-link, h2:hover .anchor .octicon-link, h3:hover .anchor .octicon-link, h4:hover .anchor .octicon-link, h5:hover .anchor .octicon-link, h6:hover .anchor .octicon-link { display: inline-block; } h1 { font-size: 2.2em; padding-top: 0.6em; } h1 .anchor { line-height: 1; } h2 { font-size: 1.8em; line-height: 1.2; padding-top: 0.6em; } h2 .anchor { line-height: 1.2; } h3 { font-size: 1.3em; line-height: 1; padding-top: 0.6em; } h3 .anchor { line-height: 1.2; } h4 { font-size: 1em; } h4 .anchor { line-height: 1.2; } h5 { font-size: 1em; } h5 .anchor { line-height: 1.1; } h6 { font-size: 1em; } h6 .anchor { line-height: 1.1; } p, blockquote, ul, ol, dl, table, pre { margin-top: 16px; margin-bottom: 16px; } ul, ol { padding-left: 2em; } ul ul, ul ol, ol ol, ol ul { margin-top: 0; margin-bottom: 0; } li &gt; p { margin-top: 0; margin-bottom: 0; } dl { padding: 0; } dl dt { padding: 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; } dl dd { padding: 0 16px; margin-bottom: 16px; } blockquote { padding: 10px 10px 10px 16px; border-left: 2px solid; border-radius: 0 3px 3px 0; } blockquote &gt; :first-child { margin-top: 0; } blockquote &gt; :last-child { margin-bottom: 0; } table { display: block; width: 100%; overflow: auto; word-break: normal; border-collapse: collapse; border-spacing: 0; font-size: 1em; } table th { font-weight: bold; } table th, table td { padding: 6px 13px; background: transparent; } table tr { border-top: 1px solid; } img { max-width: 100%; box-sizing: border-box; } code { font: 0.9em "JetBrains Mono", Consolas, "Liberation Mono", Menlo, Courier, monospace; padding: 0.2em 0.4em; margin: 2px; border-radius: 3px; } pre &gt; code { padding: 0; margin: 0; font-size: 100%; word-break: normal; white-space: pre; background: transparent; border: 0; } .highlight { margin-bottom: 16px; } .highlight pre, pre { font: 0.85em "JetBrains Mono", Consolas, "Liberation Mono", Menlo, Courier, monospace; padding: 16px; overflow: auto; line-height: 1.45; border-radius: 3px; } pre code { display: inline; max-width: initial; padding: 0; margin: 0; overflow: initial; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0; } pre code:before, pre code:after { content: normal; } kbd { font: 0.9em "JetBrains Mono", Consolas, "Liberation Mono", Menlo, Courier, monospace; padding: 0.2em 0.4em; margin: 2px; border-radius: 3px; } .task-list-item { list-style-type: none; } .task-list-item + .task-list-item { margin-top: 3px; } .task-list-item input { margin: 0 0.35em 0.25em -0.6em; vertical-align: middle; } :checked + .radio-label { z-index: 1; position: relative; } span.user-del { text-decoration: line-through; } ::-webkit-scrollbar { width: 6px; height: 6px; } ::-webkit-scrollbar-thumb { -webkit-border-radius: 10px; } ::-webkit-scrollbar-track:vertical { -webkit-box-shadow: -1px 0 0 #ededed; } ::-webkit-scrollbar-track { background-color: transparent; } ::-webkit-scrollbar { width: 6px; } </style>
  <style>body { background-color: rgba(255, 255, 255, 255.0); font-size: 14px !important; } body, p, blockquote, ul, ol, dl, table, pre, code, tr { color: rgba(8, 8, 8, 255.0); } a { color: rgba(36, 112, 179, 255.0); } table td, table th { border: 1px solid rgba(205, 205, 205, 255.0); } hr { background-color: rgba(205, 205, 205, 255.0); } kbd, tr { border: 1px solid rgba(205, 205, 205, 255.0); } h6 { color: rgba(153, 153, 153, 255.0); } blockquote { border-left: 2px solid rgba(36, 112, 179, 0.4); } ::-webkit-scrollbar-thumb { background-color: rgba(115, 115, 115, 0.2); } blockquote, code, pre { background-color: rgba(212, 222, 231, 0.24705882352941178); }</style>
 </head> 
 <body>
  <div md-src-pos="0..16987">
   <h1 md-src-pos="0..36">Une sélection d'Evil User Stories</h1>
   <p md-src-pos="39..95"><em md-src-pos="39..95">projet : VETUX-LINE BTS SIO SLAM 2ième année 2021-2022</em></p>
   <h2 md-src-pos="97..142">Evil User Stories - <em md-src-pos="120..142">Le nain et l'échelle</em></h2>
   <h3 md-src-pos="144..150">A/</h3>
   <p md-src-pos="152..571"><strong md-src-pos="152..571">En tant que personne malveillante, j'ai réussi à savoir que cette application est faite avec symfony et que les développeurs ont utilisé le <em md-src-pos="294..311">security bundle</em> avec <em md-src-pos="317..331">maker bundle</em>. Ils ont certainement hashé les mots de passe à la création mais pas à la modification alors je veux avoir accès à la base de données pour récupérer les mots de passe et les identifiants des utilisateurs qui ont changé leur mot de passe.</strong></p>
   <p md-src-pos="573..926"><strong md-src-pos="573..590">Contre-mesure</strong> : <span md-src-pos="593..617">En tant que développeur,</span> <span md-src-pos="618..650">je veux hasher les mots de passe</span> <span md-src-pos="651..652">à</span> <span md-src-pos="653..814">leur modification pour empêcher un utilisateur malveillant de pouvoir les lire en clair sur la base de données et les utilisés pour une utilisation malveillante.</span> <span md-src-pos="815..829">Pour cela dans</span> <code md-src-pos="830..857">UtilisateurController.php</code> <span md-src-pos="858..887">je dois importer la librairie</span> <code md-src-pos="888..917">UserPasswordHasherInterface</code><br> <span md-src-pos="920..924">avec</span>:</p>
   <pre md-src-pos="928..1011"><code class="language-php" md-src-pos="928..1011"><span md-src-pos="928..935"></span><span md-src-pos="935..1007">use Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface;</span>
<span md-src-pos="1008..1008"></span><span md-src-pos="1008..1011"></span></code></pre>
   <p md-src-pos="1013..1073"><span md-src-pos="1013..1042">Puis dans le même contrôleur,</span> <span md-src-pos="1043..1065">je modifie la fonction</span> <code md-src-pos="1066..1072">edit</code>:</p>
   <pre md-src-pos="1075..1914"><code class="language-php" md-src-pos="1075..1914"><span md-src-pos="1075..1082"></span><span md-src-pos="1082..1162"> #[Route('/admin/{id}/edit', name: 'utilisateur_edit', methods: ['GET','POST'])]</span>
<span md-src-pos="1163..1286">    public function edit(Request $request, Utilisateur $utilisateur, UserPasswordHasherInterface $passwordHasher): Response</span>
<span md-src-pos="1287..1292">    {</span>
<span md-src-pos="1293..1368">        $form = $this-&gt;createForm(UtilisateurType::class, $utilisateur);</span>
<span md-src-pos="1369..1411">        $form-&gt;handleRequest($request);</span>
<span md-src-pos="1412..1412"></span>
<span md-src-pos="1413..1482">        if ($form-&gt;isSubmitted() &amp;&amp; $form-&gt;isValid()) {</span>
<span md-src-pos="1483..1524">            $utilisateur-&gt;setPassword(</span>
<span md-src-pos="1525..1621">                $passwordHasher-&gt;hashPassword($utilisateur, $utilisateur-&gt;getPassword()));</span>
<span md-src-pos="1622..1687">            $this-&gt;getDoctrine()-&gt;getManager()-&gt;flush();</span>
<span md-src-pos="1688..1688"></span>
<span md-src-pos="1689..1785">            return $this-&gt;redirectToRoute('utilisateur_index', [], Response::HTTP_SEE_OTHER);</span>
<span md-src-pos="1786..1795">        }</span>
<span md-src-pos="1796..1796"></span>
<span md-src-pos="1797..1864">        return $this-&gt;renderForm('utilisateur/edit.html.twig', [</span>
<span md-src-pos="1865..1910">            'utilisateur' =&gt; $utilisateur,</span>
<span md-src-pos="1911..1942">            'form' =&gt; $form,</span>
<span md-src-pos="1943..1954">        ]);</span>
<span md-src-pos="1955..1960">    }</span>
<span md-src-pos="1961..1961"></span><span md-src-pos="1911..1914"></span></code></pre>
   <p md-src-pos="1915..2192"><span md-src-pos="1915..1950">Dans les paramètres de la fonction,</span> <span md-src-pos="1951..1985">on instancie un objet de la classe</span> <code md-src-pos="1986..2015">UserPasswordHasherInterface</code> <span md-src-pos="2016..2034">puis on fait appel</span> <span md-src-pos="2035..2036">à</span> <span md-src-pos="2037..2048">la fonction</span> <code md-src-pos="2049..2063">hashPassword</code> <span md-src-pos="2064..2123">de la même classe dans la fonction setPassword de la classe</span> <code md-src-pos="2124..2137">Utilisateur</code><span md-src-pos="2137..2138">,</span> <span md-src-pos="2139..2145">ainsi,</span> <span md-src-pos="2146..2192">ça hashera le mot de passe tout juste modifié.</span></p>
   <h3 md-src-pos="2195..2201">B/</h3>
   <p md-src-pos="2203..2431"><strong md-src-pos="2203..2431">En tant que personne malveillante, je veux avoir avoir accès à la base de données pour récupérer des informations sur l'application Vetux-Line mais aussi d'autres bases de données qui sont sur le même serveur que Vetux-Line.</strong></p>
   <p md-src-pos="2433..2775"><strong md-src-pos="2433..2450">Contre-mesure</strong> : <span md-src-pos="2453..2477">En tant que développeur,</span> <span md-src-pos="2478..2635">je vais créer sur le serveur de base de données un utilisateur spécialement pour la base de données de Vetux-Line pour empêcher un utilisateur malveillant d</span>'<span md-src-pos="2636..2643">accéder</span> <span md-src-pos="2644..2645">à</span> <span md-src-pos="2646..2676">cette base de données ainsi qu</span>'<span md-src-pos="2677..2678">à</span> <span md-src-pos="2679..2680">d</span>'<span md-src-pos="2681..2708">autres sur le même serveur.</span> <span md-src-pos="2709..2774">Pour cela sur phpMyAdmin je crée ce nouvel utilisateur comme ceci</span>:</p>
   <p md-src-pos="2777..2888"><img src="images/140641626-46d75659-d71d-4a80-bedd-2287d71d665c.png" alt="image" md-src-pos="2777..2888"></p>
   <p md-src-pos="2890..2983"><span md-src-pos="2890..2908">Et dans le fichier</span> <code md-src-pos="2909..2915">.env</code> <span md-src-pos="2916..2982">on précise les informations de la base de données avec cette ligne</span>:</p>
   <pre md-src-pos="2985..3106"><code class="language-php" md-src-pos="2985..3106"><span md-src-pos="2985..2992"></span><span md-src-pos="2992..3112">    DATABASE_URL="mysql://vetux_line:wNgEf23m*7MZdWZ9@127.0.0.1:3306/vetux_line?serverVersion=mariadb-10.4.21"</span>
<span md-src-pos="3113..3113"></span><span md-src-pos="3103..3106"></span></code></pre>
   <h3 md-src-pos="3108..3114">C/</h3>
   <p md-src-pos="3116..3293"><strong md-src-pos="3116..3293">En tant que personne malveillante, je veux avoir accès à certaines pages sans authentification pour pouvoir avoir accès aux actions et aux données permises à certains rôles.</strong></p>
   <p md-src-pos="3295..3563"><span md-src-pos="3295..3319">En tant que développeur,</span> <span md-src-pos="3320..3362">je veux autoriser seulement certains rôles</span> <span md-src-pos="3363..3364">à</span> <span md-src-pos="3365..3395">aller sur certaines pages pour</span> <span md-src-pos="3396..3405">éviter qu</span>'<span md-src-pos="3406..3479">un utilisateur malveillant ait accès aux actions et données de ces rôles.</span> <span md-src-pos="3480..3516">Pour cela je modifie dans le fichier</span> <code md-src-pos="3517..3532">security.yaml</code> <span md-src-pos="3533..3546">les lignes de</span> <code md-src-pos="3547..3562">acces_control</code>:</p>
   <pre md-src-pos="3565..3705"><code class="language-php" md-src-pos="3565..3705"><span md-src-pos="3565..3572"></span><span md-src-pos="3572..3587">access_control:</span>
<span md-src-pos="3588..3647">         - { path: ^/utilisateur/admin, roles: ROLE_ADMIN }</span>
<span md-src-pos="3648..3701">         - { path: ^/home, roles: ROLE_GESTIONNAIRE }</span>
<span md-src-pos="3702..3702"></span><span md-src-pos="3702..3705"></span></code></pre>
   <p md-src-pos="3706..3950"><span md-src-pos="3706..3712">Ainsi,</span> <span md-src-pos="3713..3745">toutes les routes commençant par</span> <code md-src-pos="3746..3766">/utilisateur/admin</code> <span md-src-pos="3767..3830">seront uniquemant accessibles par les utilisateurs avec le rôle</span> <code md-src-pos="3831..3843">ROLE_ADMIN</code> <span md-src-pos="3844..3885">et pareil pour les routes commençant par</span> <code md-src-pos="3886..3893">/home</code> <span md-src-pos="3894..3927">pour les utilisateur avec le rôle</span> <code md-src-pos="3928..3947">ROLE_GESTIONNAIRE</code><span md-src-pos="3947..3948">.</span></p>
   <p md-src-pos="3952..4074"><span md-src-pos="3952..3964">Par exemple,</span> <code md-src-pos="3965..3992">UtilisateurController.php</code> <span md-src-pos="3993..4004">est associé</span> <span md-src-pos="4005..4006">à</span> <span md-src-pos="4007..4010">une</span> <em md-src-pos="4011..4035">racine de route propre</em><span md-src-pos="4035..4036">,</span> <span md-src-pos="4037..4072">pour toutes ses méthodes contrôleur</span> :</p>
   <pre md-src-pos="4076..4166"><code class="language-php" md-src-pos="4076..4166"><span md-src-pos="4076..4083"></span><span md-src-pos="4083..4107">#[Route('/utilisateur')]</span>
<span md-src-pos="4108..4162">class UtilisateurController extends AbstractController</span>
<span md-src-pos="4163..4163"></span><span md-src-pos="4163..4166"></span></code></pre>
   <p md-src-pos="4167..4413"><span md-src-pos="4167..4197">Et dans les routes des admins,</span> <span md-src-pos="4198..4204">il y a</span> <code md-src-pos="4205..4213">/admin</code> <span md-src-pos="4214..4235">donc on retrouve bien</span> <code md-src-pos="4236..4256">/utilisateur/admin</code> (<span md-src-pos="4258..4280">voir la fonction du A/</span> <span md-src-pos="4281..4293">pour exemple</span>)<span md-src-pos="4294..4295">.</span><br> <span md-src-pos="4298..4302">Pour</span> <code md-src-pos="4303..4310">/home</code><span md-src-pos="4310..4311">,</span> <span md-src-pos="4312..4319">dans la</span> <code md-src-pos="4320..4342">UploadController.php</code> <span md-src-pos="4343..4345">là</span> <span md-src-pos="4346..4348">où</span> <span md-src-pos="4349..4405">il y a toutes les méthodes contrôleur des gestionnaires,</span> <span md-src-pos="4406..4412">on met</span>:</p>
   <pre md-src-pos="4415..4493"><code class="language-php" md-src-pos="4415..4493"><span md-src-pos="4415..4422"></span><span md-src-pos="4422..4439">#[Route('/home')]</span>
<span md-src-pos="4440..4489">class UploadController extends AbstractController</span>
<span md-src-pos="4490..4490"></span><span md-src-pos="4490..4493"></span></code></pre>
   <p md-src-pos="4494..4515"><span md-src-pos="4494..4507">On retouve le</span> <span md-src-pos="4508..4513">/home</span> <span md-src-pos="4514..4515">.</span></p>
   <h3 md-src-pos="4517..4523">D/</h3>
   <p md-src-pos="4525..4637"><strong md-src-pos="4525..4637">En tant que personne malveillante, je veux uploader des fichiers pour faire planter le serveur ou le hacker.</strong></p>
   <p md-src-pos="4639..4907"><strong md-src-pos="4639..4656">Contre-mesure</strong> : <span md-src-pos="4659..4683">En tant que développeur,</span> <span md-src-pos="4684..4735">je veux seulement autoriser les fichiers csv dans l</span>'<span md-src-pos="4736..4747">upload pour</span> <span md-src-pos="4748..4782">éviter des attaques malveillantes.</span> <span md-src-pos="4783..4850">Pour cela je dois dans UploadController.php dans la fonction index,</span> <span md-src-pos="4851..4858">vérifié</span> <span md-src-pos="4859..4905">le type de chaque fichier reçu par la fonction</span>:</p>
   <pre md-src-pos="4909..5295"><code class="language-php" md-src-pos="4909..5295"><span md-src-pos="4909..4916"></span><span md-src-pos="4916..4941">foreach ($files as $file)</span>
<span md-src-pos="4942..4951">        {</span>
<span md-src-pos="4952..5000">            $filetype = $file-&gt;getMimeType();</span>
<span md-src-pos="5001..5050">            if (str_contains($filetype, '/csv')){</span>
<span md-src-pos="5051..5113">                $filename = $file-&gt;getClientOriginalName();</span>
<span md-src-pos="5114..5181">                $uploader-&gt;upload($uploadDir, $file, $filename);</span>
<span md-src-pos="5182..5195">            }</span>
<span md-src-pos="5196..5214">            else {</span>
<span md-src-pos="5215..5279">                return $this-&gt;render('home/index.html.twig');</span>
<span md-src-pos="5280..5293">            }</span>
<span md-src-pos="5294..5303">        }</span>
<span md-src-pos="5304..5304"></span><span md-src-pos="5292..5295"></span></code></pre>
   <p md-src-pos="5296..5387"><code md-src-pos="5296..5311">getMimeType()</code> <span md-src-pos="5312..5368">renvoie le type de fichier avec son extension sous forme</span>: <code md-src-pos="5370..5386">type/extension</code><span md-src-pos="5386..5387">.</span></p>
   <p md-src-pos="5389..5581"><span md-src-pos="5389..5439">Ici on vérifie juste si dans ce retour on a bien l</span>'<span md-src-pos="5440..5449">extension</span> <code md-src-pos="5450..5455">csv</code> <span md-src-pos="5456..5469">avec un appel</span> <span md-src-pos="5470..5471">à</span> <code md-src-pos="5472..5486">str_contains</code> <span md-src-pos="5487..5534">et si oui on récupère le nom du fichier et on l</span>'<span md-src-pos="5535..5542">upload,</span> <span md-src-pos="5543..5559">sinon on renvoie</span> <span md-src-pos="5560..5561">à</span> <span md-src-pos="5562..5571">la page d</span>'<span md-src-pos="5572..5579">upload.</span></p>
   <p md-src-pos="5583..5698"><span md-src-pos="5583..5595">Nos fichiers</span> <code md-src-pos="5596..5601">csv</code> <span md-src-pos="5602..5653">ont comme MimeType application/csv et pas text/cvs,</span> <span md-src-pos="5654..5666">on a donc dû</span> <span md-src-pos="5667..5687">vérifier seulement l</span>'<span md-src-pos="5688..5698">extension.</span></p>
   <h2 md-src-pos="5701..5738">Evil User Stories - <em md-src-pos="5724..5738">Les Pas d'ID</em></h2>
   <h3 md-src-pos="5740..5746">A/</h3>
   <p md-src-pos="5748..5920"><strong md-src-pos="5748..5920">En tant qu’utilisateur malveillant je veux avoir accès au serveur distant en exploitant une faille « upload » donc, pour avoir accès aux différents fichiers ou données…</strong></p>
   <p md-src-pos="5922..6133"><strong md-src-pos="5922..5939">Contre-mesure</strong> : <span md-src-pos="5942..5983">En tant que développeur pour empêcher les</span> <span md-src-pos="5984..6052">utilisateurs malveillants d’uploader un shell je peux contrôler quel</span> <span md-src-pos="6053..6133">type de fichier l’utilisateur peut envoyer et ainsi vérifier que c’est bien csv.</span></p>
   <pre md-src-pos="6135..6257"><code md-src-pos="6135..6257"><span md-src-pos="6135..6139"></span><span md-src-pos="6139..6217">if(preg_match("#csv#",$_FILES["text"]["type"])){</span>
<span md-src-pos="6218..6254">  echo "fichier envoyé !";</span>
<span md-src-pos="6255..6261">}else{</span>
<span md-src-pos="6262..6301">  echo "Fichier non valide.";</span>
<span md-src-pos="6302..6303">}</span>
<span md-src-pos="6304..6304"></span><span md-src-pos="6254..6257"></span></code></pre>
   <p md-src-pos="6259..6327"><span md-src-pos="6259..6286">Si c’est un fichier de type</span> <code md-src-pos="6287..6292">csv</code> <span md-src-pos="6293..6316">le fichier est accepté,</span> <span md-src-pos="6317..6327">sinon non.</span></p>
   <p md-src-pos="6329..6508"><mark><span md-src-pos="6335..6357">Ce traitement est naïf</span> (<span md-src-pos="6359..6370">insuffisant</span>)<span md-src-pos="6371..6372">.</span> <span md-src-pos="6373..6412">Un traitement plus efficace consiterait</span> <span md-src-pos="6413..6414">à</span> <span md-src-pos="6415..6434">contrôler la taille</span> (<span md-src-pos="6436..6457">via une configuration</span>) <span md-src-pos="6459..6500">et analyser les premiers octets ou lignes</span> </mark></p>
   <h3 md-src-pos="6510..6516">B/</h3>
   <p md-src-pos="6518..6672"><strong md-src-pos="6518..6672">En tant qu’utilisateur malveillant je veux empecher l’accès au site en faisant une attaque par déni de service pour réduire la productivité du service</strong></p>
   <p md-src-pos="6674..6864"><strong md-src-pos="6674..6691">Contre-mesure</strong> : <span md-src-pos="6695..6745">En tant que développeur pour empêcher les attaques</span> <span md-src-pos="6746..6813">dos je developpe un site miroir et je me sers des protections mis a</span> <span md-src-pos="6814..6864">disposition par des entreprises tel que cloudflare</span></p>
   <h3 md-src-pos="6866..6872">C/</h3>
   <p md-src-pos="6875..6987"><strong md-src-pos="6875..6987">En tant qu’utilisateur malveillant je veux acceder a l’administration du site via brute force pour le deface</strong></p>
   <p md-src-pos="6989..7324"><strong md-src-pos="6989..7006">Contre-mesure</strong> : <span md-src-pos="7009..7051">En tant que développeur je met en place un</span> <strong md-src-pos="7052..7063">captcha</strong> <span md-src-pos="7064..7068">pour</span> <span md-src-pos="7069..7092">éviter le spam des bots</span> <strong md-src-pos="7093..7099">ou</strong> <span md-src-pos="7100..7298">bien je me sers de JS tout d’abord je crée une page spécialement faite pour les bots et ensuite je rajoute l’url dans l’action de mon formulaire de connection si la souris bouge alors on supprime le</span> <span md-src-pos="7299..7324">/bot dans la route cible.</span></p>
   <p md-src-pos="7326..7354"><span md-src-pos="7326..7352">Exemple simple avec JQuery</span> :</p>
   <pre md-src-pos="7356..7627"><code class="language-js" md-src-pos="7356..7627"><span md-src-pos="7347..7353"></span><span md-src-pos="7353..7385">&lt;<span style="color: rgb(0, 51, 179);">script</span> <span style="color: rgb(23, 74, 212);">type</span><span style="color: rgb(6, 125, 23);">=</span><span style="color: rgb(6, 125, 23);">"</span><span style="color: rgb(6, 125, 23);">text/javascript</span><span style="color: rgb(6, 125, 23);">"</span>&gt;</span>
<span md-src-pos="7385..7416"><span style="color: rgb(8, 8, 8);">$(document).ready(function()</span> {</span>
<span md-src-pos="7416..7460">  $(document).one(<span style="color: rgb(6, 125, 23);">'mousemove'</span>, <span style="color: rgb(0, 51, 179);">function</span>() {</span>
<span md-src-pos="7460..7496">    <span style="color: rgb(0, 51, 179);">var</span> $form = $(<span style="color: rgb(6, 125, 23);">'#comment_form'</span>);</span>
<span md-src-pos="7496..7561">    <span style="color: rgb(0, 51, 179);">var</span> action = $form.attr(<span style="color: rgb(6, 125, 23);">'action'</span>).replace(<span style="color: rgb(6, 125, 23);">"/^</span><span style="color: rgb(0, 55, 166);">\/</span><span style="color: rgb(6, 125, 23);">bot</span><span style="color: rgb(0, 55, 166);">\?</span><span style="color: rgb(6, 125, 23);">/"</span>, <span style="color: rgb(6, 125, 23);">''</span>);</span>
<span md-src-pos="7561..7595">    $form.attr(<span style="color: rgb(6, 125, 23);">'action'</span>, action);</span>
<span md-src-pos="7595..7601">  });</span>
<span md-src-pos="7601..7605">}<span style="color: rgb(8, 8, 8);">);</span></span>
<span md-src-pos="7605..7615">&lt;/<span style="color: rgb(0, 51, 179);">script</span>&gt;</span>
<span md-src-pos="7615..7616"></span><span md-src-pos="7615..7618"></span></code></pre>
   <p md-src-pos="7628..7708"><span md-src-pos="7628..7634">Source</span> : <a href="https://www.deblan.io/post/429/contrer-des-robots-stupides-sans-captcha" md-src-pos="7637..7708">https://www.deblan.io/post/429/contrer-des-robots-stupides-sans-captcha</a></p>
   <h2 md-src-pos="7710..7742">Evil User Stories - <em md-src-pos="7733..7742">Yannick</em></h2>
   <h3 md-src-pos="7744..7750">A/</h3>
   <p md-src-pos="7751..7896"><strong md-src-pos="7751..7896">En tant que personne malveillante, je veux uploader des fichiers avec une autre extension que celle demandée afin de faire planter le serveur</strong></p>
   <p md-src-pos="7898..8355"><strong md-src-pos="7898..7915">Contre-mesure</strong> : <span md-src-pos="7918..7942">En tant que développeur,</span> <span md-src-pos="7943..7949">afin d</span>'<span md-src-pos="7950..8053">empêcher les personnes malveillantes qui souhaitent uploader des fichiers avec des extensions autre que</span> <span md-src-pos="8054..8092">.csv afin de faire planter le serveur,</span> <span md-src-pos="8093..8094">j</span>'<span md-src-pos="8095..8176">ai mis en place dans les différents fichiers de formulaire qui demande un fichier</span> ( <code md-src-pos="8179..8222">EtlCsvForm, InvalidCsvForm, MergeCsvForm</code>) <span md-src-pos="8224..8242">un système de type</span> <code md-src-pos="8243..8282">Multipurpose Internet Mail Extensions</code> ( <span md-src-pos="8285..8294">mimeTypes</span> ) <span md-src-pos="8297..8316">qui aura pour but d</span>'<span md-src-pos="8317..8355">indiquer le format du fichier demandé.</span></p>
   <pre md-src-pos="8357..8621"><code class="language-js" md-src-pos="8357..8621"><span md-src-pos="8342..8348"></span><span md-src-pos="8348..8349"></span>
<span md-src-pos="8349..8382">-&gt;add(<span style="color: rgb(6, 125, 23);">'csv1'</span>, FileType::<span style="color: rgb(0, 51, 179);">class</span>, [</span>
<span md-src-pos="8382..8405">   <span style="color: rgb(6, 125, 23);">"label"</span> =&gt; <span style="color: rgb(6, 125, 23);">"CSV 1"</span>,</span>
<span md-src-pos="8405..8427">   <span style="color: rgb(6, 125, 23);">"constraints"</span> =&gt; [</span>
<span md-src-pos="8427..8448">     <span style="color: rgb(0, 51, 179);">new</span> NotBlank(),</span>
<span md-src-pos="8448..8464">     <span style="color: rgb(0, 51, 179);">new</span> File([</span>
<span md-src-pos="8464..8487">      <span style="color: rgb(6, 125, 23);">'mimeTypes'</span> =&gt; [</span>
<span md-src-pos="8487..8509">        <span style="color: rgb(6, 125, 23);">'text/x-csv'</span>,</span>
<span md-src-pos="8509..8529">        <span style="color: rgb(6, 125, 23);">'text/csv'</span>,</span>
<span md-src-pos="8529..8558">        <span style="color: rgb(6, 125, 23);">'application/x-csv'</span>,</span>
<span md-src-pos="8558..8587">        <span style="color: rgb(6, 125, 23);">'application/csv'</span>,],</span>
<span md-src-pos="8587..8594">     ]</span>
<span md-src-pos="8594..8603">     ...</span>
<span md-src-pos="8603..8604"></span><span md-src-pos="8603..8606"></span></code></pre>
   <p md-src-pos="8623..8972"><span md-src-pos="8623..8628">Suite</span> <span md-src-pos="8629..8630">à</span> <span md-src-pos="8631..8654">cela dans le contrôleur</span> <code md-src-pos="8655..8672">IndexController</code><span md-src-pos="8672..8673">,</span> <span md-src-pos="8674..8718">plus précisément dans la fonction merge si c</span>'<span md-src-pos="8719..8731">est la route</span> <code md-src-pos="8732..8746">admin/fusion</code> <span md-src-pos="8747..8764">qui est demandée,</span> <span md-src-pos="8765..8792">nous allons vérifier avec l</span>'<span md-src-pos="8793..8839">exécution conditionnelle if si le formulaire a</span> <span md-src-pos="8840..8843">été</span> <span md-src-pos="8844..8850">envoyé</span> <span md-src-pos="8851..8867">avec la fonction</span> <code md-src-pos="8868..8881">isSubmitted</code> <span md-src-pos="8882..8943">et si le format des fichiers reçus est bien le format demandé</span> <span md-src-pos="8944..8960">avec la fonction</span> <code md-src-pos="8961..8970">isValid</code> <span md-src-pos="8971..8972">.</span></p>
   <p md-src-pos="8974..9039"><code md-src-pos="8974..9039">if ($csvMergeForm-&gt;isSubmitted() &amp;&amp; $csvMergeForm-&gt;isValid()) {</code></p>
   <p md-src-pos="9041..9257"><span md-src-pos="9041..9045">Si l</span>'<span md-src-pos="9046..9080">expression booléenne répond false,</span> <span md-src-pos="9081..9127">cela veut dire que le format du fichier envoyé</span> <span md-src-pos="9128..9129">n</span>'<span md-src-pos="9130..9156">est pas le format attendu,</span> <span md-src-pos="9157..9158">l</span>'<span md-src-pos="9159..9192">utilisateur recevra une réponse d</span>'<span md-src-pos="9193..9237">erreur lui expliquant que seuls les fichiers</span> <span md-src-pos="9238..9257">Csv sont autorisés.</span></p>
   <p md-src-pos="9259..9324"><code md-src-pos="9259..9324">"mimeTypesMessage" =&gt; "Seul les fichiers CSV sont autorisées !"</code></p>
   <mark> Hum... il faut vérifier cela, en invalidant la vérification côté client par (vue twig) : </mark> 
   <p md-src-pos="9431..9493"><code md-src-pos="9431..9493">{{ form_start(form, {attr: {'novalidate': 'novalidate'}}) }}</code></p>
   <h3 md-src-pos="9495..9501">B/</h3>
   <p md-src-pos="9502..9680"><strong md-src-pos="9502..9680">En tant que personne malveillante, je veux utiliser la barre d'adresse afin d'avoir accès aux différentes routes de l'application Vetux-line sans avoir besoin de me connecter</strong></p>
   <p md-src-pos="9682..9898"><strong md-src-pos="9682..9699">Contre-mesure</strong> : <span md-src-pos="9702..9726">En tant que développeur,</span> <span md-src-pos="9727..9733">afin d</span>'<span md-src-pos="9734..9786">empêcher les personnes malveillantes qui souhaitent,</span> <span md-src-pos="9787..9788">à</span> <span md-src-pos="9789..9809">partir de la barre d</span>'<span md-src-pos="9810..9818">adresse,</span> <span md-src-pos="9819..9854">accéder aux différentes routes de l</span>'<span md-src-pos="9855..9882">application Vetux-Line sans</span> <span md-src-pos="9883..9896">être connecté</span>**</p>
   <p md-src-pos="9900..10381"><span md-src-pos="9900..9959">Le controller IndexController qui appelle chaque route de l</span>'<span md-src-pos="9960..9981">application possède l</span>'<span md-src-pos="9982..9992">annotation</span> <code md-src-pos="9993..10019">@IsGranted("ROLE_ADMIN")</code><span md-src-pos="10019..10020">.</span> <span md-src-pos="10021..10061">Cette annotation permet de restreindre l</span>'<span md-src-pos="10062..10067">accès</span> <span md-src-pos="10068..10069">à</span> <span md-src-pos="10070..10116">tous les utilisateurs qui ne sont pas connecté</span> <span md-src-pos="10117..10146">ou qui ne possède pas le rôle</span> <code md-src-pos="10147..10159">ROLE_ADMIN</code> <span md-src-pos="10160..10197">aux différentes routes du controller.</span> <span md-src-pos="10198..10223">La personne malveillante,</span> <span md-src-pos="10224..10251">en essayant de se connecter</span> <span md-src-pos="10252..10253">à</span> <span md-src-pos="10254..10262">la route</span> <code md-src-pos="10263..10277">admin/fusion</code> <span md-src-pos="10278..10290">par exemple,</span> <span md-src-pos="10291..10319">ne va pas pouvoir y accéder,</span> <span md-src-pos="10320..10381">car elle sera directement redirigée sur la page de connexion.</span></p>
   <p md-src-pos="10383..10436"><span md-src-pos="10383..10405">Vidéo de démonstration</span> : <a href="https://youtu.be/DO1L1NVX6XI" md-src-pos="10408..10436">https://youtu.be/DO1L1NVX6XI</a></p>
   <h2 md-src-pos="10439..10475">Evil User Stories - <em md-src-pos="10462..10475">Brancodeurs</em></h2>
   <h3 md-src-pos="10477..10483">A/</h3>
   <p md-src-pos="10484..10624"><strong md-src-pos="10484..10624">En tant que personne malveillante, je veux faire une injection sql afin d’accéder à la base de données ou me connecter sans mot de passe</strong></p>
   <p md-src-pos="10626..10830"><strong md-src-pos="10626..10643">Contre-mesure</strong> : <span md-src-pos="10646..10786">En tant que développeur je veux empêcher les personnes malveillantes de se connecter par l’intermédiaire d’une injection sql ou de modifier,</span> <span md-src-pos="10787..10830">supprimer ou s’octroyer la base de données.</span></p>
   <p md-src-pos="10832..11036"><span md-src-pos="10832..10939">Symfony possède des protections contre ce genre d’attaques car elles sont communes et toujours d’actualité.</span> <span md-src-pos="10940..11023">Avec ce genre de faille cela permettait de se connecter sans mot de passe avec ceci</span> <span md-src-pos="11024..11025">à</span> <span md-src-pos="11026..11034">la place</span> :</p>
   <pre md-src-pos="11039..11139"><code class="language-sql" md-src-pos="11039..11139"><span md-src-pos="11012..11019"></span><span md-src-pos="11019..11020"></span>
<span md-src-pos="11020..11045"><span style="color: rgb(0, 51, 179);">select</span> * <span style="color: rgb(0, 51, 179);">from</span> user_table</span>
<span md-src-pos="11045..11108"><span style="color: rgb(0, 51, 179);">where</span> username = <span style="color: rgb(6, 125, 23);">'admin'</span> <span style="color: rgb(0, 51, 179);">and</span> <span style="color: rgb(0, 51, 179);">password</span> = <span style="color: rgb(6, 125, 23);">'password'</span> <span style="color: rgb(0, 51, 179);">or</span> <span style="color: rgb(23, 80, 235);">1</span>=<span style="color: rgb(23, 80, 235);">1</span>;<span style="color: rgb(140, 140, 140);">--';</span></span>
<span md-src-pos="11108..11109"></span>
<span md-src-pos="11109..11110"></span><span md-src-pos="11109..11112"></span></code></pre>
   <p md-src-pos="11141..11612"><em md-src-pos="11143..11575">“Une vulnérabilité d’injection SQL dans le générateur d’administration Doctrine a été signalée plus tôt aujourd’hui et a été traitée dans ces versions de sécurité 1.2.12, 1.3.3 et 1.4.3. Cette vulnérabilité était limitée au générateur d’administration de doctrine. Nous recommandons que tous les projets qui utilisent ce service de générateur d’administration de doctrine de mettre à jour les dernières versions immédiatement.”</em> <span md-src-pos="11578..11580">--</span><cite><span md-src-pos="11586..11605">Patch notes Symfony</span></cite></p>
   <h2 md-src-pos="11615..11650">Evil User Story - <em md-src-pos="11636..11650">Schoolalexis</em></h2>
   <h3 md-src-pos="11652..11658">A/</h3>
   <p md-src-pos="11659..11818">**"<em md-src-pos="11662..11817">En tant que <strong md-src-pos="11675..11700">personne malveillante</strong>, je veux <strong md-src-pos="11710..11746">avoir accès à la base de données</strong> afin d'<strong md-src-pos="11754..11816">exploiter les mots de passes et autres données ci-trouvant</strong></em>"</p>
   <p md-src-pos="11820..12146"><strong md-src-pos="11820..11837">Contre-mesure</strong> : <span md-src-pos="11840..11851">En tant que</span> <strong md-src-pos="11852..11867">développeur</strong><span md-src-pos="11867..11868">,</span> <span md-src-pos="11869..11875">afin d</span>'<strong md-src-pos="11876..12041">empêcher des personnes malveillantes qui sauteraient, à partir de la base de données, se connecter aux comptes des utilisateurs et exploiter leurs mots de passes</strong> (<span md-src-pos="12043..12059">dans le cas de l</span>'<span md-src-pos="12060..12082">application Vetux Line</span>) <strong md-src-pos="12084..12145">j'utiliserais le hashage pour protéger les mots de passes</strong><span md-src-pos="12145..12146">.</span></p>
   <p md-src-pos="12148..12218"><span md-src-pos="12148..12158">Pour cela,</span> <span md-src-pos="12159..12174">deux solutions,</span> <span md-src-pos="12175..12218">sont applicables sur mon projet Vetux Line.</span></p>
   <p md-src-pos="12220..12421"><span md-src-pos="12220..12239">Le premier serait d</span>'<span md-src-pos="12240..12277">utiliser la fonction de hashage dès l</span>'<span md-src-pos="12278..12297">appel de la méthode</span> <code md-src-pos="12298..12311">setPassword</code> <span md-src-pos="12312..12313">à</span> <span md-src-pos="12314..12315">l</span>'<span md-src-pos="12316..12332">aide de la class</span> <code md-src-pos="12333..12363">UserPasswordEncoderInterface</code><span md-src-pos="12363..12364">.</span> <span md-src-pos="12365..12366">C</span>'<span md-src-pos="12367..12372">est d</span>'<span md-src-pos="12373..12401">ailleur cette solution qui a</span> <span md-src-pos="12402..12405">été</span> <span md-src-pos="12406..12420">appliquée ici.</span></p>
   <p md-src-pos="12423..12587"><span md-src-pos="12423..12444">La deuxième solution,</span> <span md-src-pos="12445..12450">quant</span> <span md-src-pos="12451..12452">à</span> <span md-src-pos="12453..12458">elle,</span> <span md-src-pos="12459..12464">est d</span>'<span md-src-pos="12465..12497">utiliser la fonction de hashage,</span> <span md-src-pos="12498..12516">directement dans l</span>'<span md-src-pos="12517..12523">entité</span> <code md-src-pos="12524..12531">Admin</code><span md-src-pos="12531..12532">,</span> <span md-src-pos="12533..12534">à</span> <span md-src-pos="12535..12536">l</span>'<span md-src-pos="12537..12570">aide de la fonction native de PHP</span> <code md-src-pos="12571..12586">password_hash</code><span md-src-pos="12586..12587">.</span></p>
   <p md-src-pos="12589..12598"><span md-src-pos="12589..12596">Exemple</span> :</p>
   <ul md-src-pos="12600..12616">
    <li md-src-pos="12600..12616">Solution n°1 :</li>
   </ul>
   <pre md-src-pos="12618..13366"><code class="language-php" md-src-pos="12618..13366"><span md-src-pos="12618..12625"></span><span md-src-pos="12625..12633">&lt;?php</span>
<span md-src-pos="12634..12669">// src/DataFixtures/AppFixtures.php</span>
<span md-src-pos="12670..12697">namespace App\DataFixtures;</span>
<span md-src-pos="12698..12698"></span>
<span md-src-pos="12699..12742">use Doctrine\Bundle\FixturesBundle\Fixture;</span>
<span md-src-pos="12743..12782">use Doctrine\Persistence\ObjectManager;</span>
<span md-src-pos="12783..12856">use Symfony\Component\Security\Core\Encoder\UserPasswordEncoderInterface;</span>
<span md-src-pos="12857..12878">use App\Entity\Admin;</span>
<span md-src-pos="12879..12879"></span>
<span md-src-pos="12880..12913">class AppFixtures extends Fixture</span>
<span md-src-pos="12914..12915">{</span>
<span md-src-pos="12916..12916"></span>
<span md-src-pos="12917..12946">    private $passwordEncoder;</span>
<span md-src-pos="12947..12947"></span>
<span md-src-pos="12948..13027">    public function __construct(UserPasswordEncoderInterface $passwordEncoder){</span>
<span md-src-pos="13028..13081">        $this-&gt;passwordEncoder = $passwordEncoder;</span>
<span md-src-pos="13082..13087">    }</span>
<span md-src-pos="13088..13088"></span>
<span md-src-pos="13089..13143">    public function load(ObjectManager $manager): void</span>
<span md-src-pos="13144..13149">    {</span>
<span md-src-pos="13150..13178">        $user = new Admin();</span>
<span md-src-pos="13179..13228">        $user-&gt;setUsername("admin");</span>
<span md-src-pos="13229..13331">        $user-&gt;setPassword($this-&gt;passwordEncoder-&gt;encodePassword($user, "admin"));</span>
<span md-src-pos="13332..13368">        $manager-&gt;persist($user);</span>
<span md-src-pos="13369..13398">        $manager-&gt;flush();</span>
<span md-src-pos="13399..13404">    }</span>
<span md-src-pos="13405..13406">}</span>
<span md-src-pos="13407..13407"></span><span md-src-pos="13363..13366"></span></code></pre>
   <ul md-src-pos="13368..13382">
    <li md-src-pos="13368..13382">Solution n°2</li>
   </ul>
   <pre md-src-pos="13384..13592"><code class="language-php" md-src-pos="13384..13592"><span md-src-pos="13384..13391"></span><span md-src-pos="13391..13414">// src/Entity/Admin.php</span>
<span md-src-pos="13415..13420">[...]</span>
<span md-src-pos="13421..13421"></span>
<span md-src-pos="13422..13477">    public function setPassword(string $password): self</span>
<span md-src-pos="13478..13483">    {</span>
<span md-src-pos="13484..13555">        $this-&gt;password = password_hash($password, PASSWORD_BCRYPT);</span>
<span md-src-pos="13556..13556"></span>
<span md-src-pos="13557..13578">        return $this;</span>
<span md-src-pos="13579..13584">    }</span>
<span md-src-pos="13585..13585"></span>
<span md-src-pos="13586..13591">[...]</span>
<span md-src-pos="13592..13592"></span><span md-src-pos="13589..13592"></span></code></pre>
   <p md-src-pos="13594..13677"><span md-src-pos="13594..13642">Les deux solutions donnant un mot de passe hashé</span> <span md-src-pos="13643..13644">à</span> <span md-src-pos="13645..13652">la fin,</span> <span md-src-pos="13653..13677">dans la base de données.</span></p>
   <p md-src-pos="13679..13714"><img src="images/hash_password.png" alt="hashpassword" md-src-pos="13679..13714"></p>
   <p md-src-pos="13716..13895"><span md-src-pos="13716..13732">Ainsi même si un</span> <strong md-src-pos="13733..13757">individu malveillant</strong> <span md-src-pos="13758..13769">réussissait</span> <span md-src-pos="13770..13771">à</span> <span md-src-pos="13772..13829">récupérer le mot de passe entrée dans la base de données,</span> <span md-src-pos="13830..13861">il ne pourrait pas se connecter</span> <span md-src-pos="13862..13863">à</span> <span md-src-pos="13864..13865">l</span>'<span md-src-pos="13866..13877">application</span> (<span md-src-pos="13879..13893">ici Vetux Line</span>)<span md-src-pos="13894..13895">.</span></p>
   <h3 md-src-pos="13898..13904">B/</h3>
   <p md-src-pos="13905..14055"><strong md-src-pos="13905..14055">En tant que <em md-src-pos="13919..13942">personne malveillante</em>, je veux <em md-src-pos="13952..13986">avoir accès à la base de données</em> afin d'<em md-src-pos="13994..14053">exploiter les mots de passe et autres données ci-trouvant</em></strong></p>
   <p md-src-pos="14057..14415"><strong md-src-pos="14057..14074">Contre-mesure</strong> : <span md-src-pos="14077..14088">En tant que</span> <strong md-src-pos="14089..14104">développeur</strong><span md-src-pos="14104..14105">,</span> <span md-src-pos="14106..14112">afin d</span>'<strong md-src-pos="14113..14276">empêcher des personnes malveillantes qui souhaitent, à partir de la base de données, se connecter aux comptes des utilisateurs et exploiter leurs mots de passe</strong> (<span md-src-pos="14278..14294">dans le cas de l</span>'<span md-src-pos="14295..14317">application Vetux Line</span>)<span md-src-pos="14318..14319">,</span> <strong md-src-pos="14320..14414">je sécurise le fichier <code md-src-pos="14345..14351">.env</code> qui contient l'identifiant de connexion à la base de données</strong><span md-src-pos="14414..14415">.</span></p>
   <p md-src-pos="14417..14654"><span md-src-pos="14417..14427">Pour cela,</span> <span md-src-pos="14428..14447">je créer un fichier</span> <code md-src-pos="14448..14460">.env.local</code><span md-src-pos="14460..14461">,</span> <span md-src-pos="14462..14513">dans lequel il va se trouver les données sensibles.</span> <span md-src-pos="14514..14525">Ce fichier,</span> <span md-src-pos="14526..14543">rend le fichier d</span>'<span md-src-pos="14544..14579">environnement encore plus sécurisé,</span> <span md-src-pos="14580..14594">car celui-ci n</span>'<span md-src-pos="14595..14654">est pas pris en compte dans le logiciel de versionnage Git.</span></p>
   <p md-src-pos="14656..14665"><span md-src-pos="14656..14663">Exemple</span> :</p>
   <pre md-src-pos="14667..14881"><code class="language-bash" md-src-pos="14667..14881"><span md-src-pos="14633..14641"></span><span md-src-pos="14641..14655">// .gitignore</span>
<span md-src-pos="14655..14656"></span>
<span md-src-pos="14656..14690"><span style="color: rgb(140, 140, 140);">###&gt; symfony/framework-bundle ###</span></span>
<span md-src-pos="14690..14702">/.env.local</span>
<span md-src-pos="14702..14718">/.env.local.php</span>
<span md-src-pos="14718..14732">/.env.*.local</span>
<span md-src-pos="14732..14778">/config/secrets/prod/prod.decrypt.private.php</span>
<span md-src-pos="14778..14795">/public/bundles/</span>
<span md-src-pos="14795..14801">/var/</span>
<span md-src-pos="14801..14810">/vendor/</span>
<span md-src-pos="14810..14844"><span style="color: rgb(140, 140, 140);">###&lt; symfony/framework-bundle ###</span></span>
<span md-src-pos="14844..14845"></span><span md-src-pos="14844..14847"></span></code></pre>
   <pre md-src-pos="14883..14985"><code class="language-bash" md-src-pos="14883..14985"><span md-src-pos="14849..14857"></span><span md-src-pos="14857..14948">DATABASE_URL=<span style="color: rgb(6, 125, 23);">"</span><span style="color: rgb(6, 125, 23);">mysql://&lt;user&gt;:&lt;password&gt;@127.0.0.1:3306/&lt;database&gt;?serverVersion=&lt;version&gt;</span><span style="color: rgb(6, 125, 23);">"</span></span>
<span md-src-pos="14948..14949"></span><span md-src-pos="14948..14951"></span></code></pre>
   <p md-src-pos="14987..15205"><span md-src-pos="14987..15020">Ainsi le fichier de configuration</span> <code md-src-pos="15021..15027">.env</code> <span md-src-pos="15028..15067">ne contiendra pas de données sensibles.</span> <span md-src-pos="15068..15098">Le développeur devra le mettre</span> <span md-src-pos="15099..15100">à</span> <span md-src-pos="15101..15106">jour,</span> <span md-src-pos="15107..15205">par exemple avec des données de connexion compatibles avec les attendues de la mise en production.</span></p>
   <h2 md-src-pos="15208..15247">Evil User Stories - <em md-src-pos="15231..15247">Les Alternants</em></h2>
   <h3 md-src-pos="15249..15255">A/</h3>
   <p md-src-pos="15256..15461"><strong md-src-pos="15256..15461">En tant que personne malveillante j’ai découvert que Vetux-Line utilise une ancienne version de Symfony pas a jour je vais donc me documenter sur les failles que l’ancienne version avait et l’exploiter</strong></p>
   <p md-src-pos="15463..15638"><strong md-src-pos="15463..15480">Contre-mesure</strong> : <span md-src-pos="15483..15537">En tant que développeur je fais bien attention d’avoir</span> <span md-src-pos="15538..15539">à</span> <span md-src-pos="15540..15565">jours Symfony et tous les</span> <span md-src-pos="15566..15608">autres composants utilisés par mon projet,</span> <span md-src-pos="15609..15636">en exécutant cette commande</span> :</p>
   <p md-src-pos="15641..15663"><code md-src-pos="15642..15663">symfony self:update</code></p>
   <p md-src-pos="15665..15671"><span md-src-pos="15666..15670">puis</span></p>
   <p md-src-pos="15673..15692"><code md-src-pos="15675..15692">composer update</code></p>
   <p md-src-pos="15697..15835"><span md-src-pos="15698..15804">Je peux aussi faire une commande supplémentaire pour vérifier qu’il n’y a pas d’autres failles de sécurité</span> <span md-src-pos="15805..15832">en exécutant cette commande</span> :</p>
   <p md-src-pos="15837..15861"><code md-src-pos="15837..15861">symfony security:check</code></p>
   <p md-src-pos="15863..15967"><span md-src-pos="15863..15914">pour vérifier que tous les composants dont dépend l</span>'<span md-src-pos="15915..15956">application n’ont pas de faille détectées</span> <span md-src-pos="15957..15958">à</span> <span md-src-pos="15959..15967">ce jour.</span></p>
   <h3 md-src-pos="15969..15975">B/</h3>
   <p md-src-pos="15976..16531"><strong md-src-pos="15976..16531">En tant que personne malveillante si j'arrive à extrait les données des utilisateurs de l'application, je compte utiliser leur identité et leur mot de passe pour accèder à d'autres application. En effet, plusieurs études (<a href="https://www.cyclonis.com/fr/rapport-83-pour-cent-utilisateurs-interroges-utilisent-meme-mot-de-passe-plusieurs-sites/" md-src-pos="16200..16317">https://www.cyclonis.com/fr/rapport-83-pour-cent-utilisateurs-interroges-utilisent-meme-mot-de-passe-plusieurs-sites/</a> ou <a href="https://www.zdnet.fr/actualites/mot-de-passe-1-personne-sur-7-n-en-utilise-qu-un-seul-partout-39829024.htm" md-src-pos="16321..16427">https://www.zdnet.fr/actualites/mot-de-passe-1-personne-sur-7-n-en-utilise-qu-un-seul-partout-39829024.htm</a> et bien d’autre..) démontrent que les personnes utilises souvent le même mot de passe un peu partout.</strong></p>
   <p md-src-pos="16533..16772"><strong md-src-pos="16533..16550">Contre-mesure</strong> : <span md-src-pos="16553..16577">En tant que développeur,</span> <span md-src-pos="16578..16626">si jamais une grosse fuite de données arriverait</span> <span md-src-pos="16627..16628">à</span> <span md-src-pos="16629..16641">se produire,</span> <span md-src-pos="16642..16655">j’ai sécurisé</span> <span md-src-pos="16656..16715">la base de données en chiffrant tous les mots de passe pour</span> <span md-src-pos="16716..16772">éviter de réutiliser les mots de passe des utilisateurs.</span></p>
   <p md-src-pos="16774..16893"><span md-src-pos="16774..16789">J’ai donc hashé</span> <span md-src-pos="16790..16828">le mot de passe des utilisateurs par l</span>'<span md-src-pos="16829..16864">intermédiaire du module de sécurité</span> <span md-src-pos="16865..16876">de Symfony,</span> <span md-src-pos="16877..16891">en particulier</span> :</p>
   <pre md-src-pos="16895..16986"><code class="language-php" md-src-pos="16895..16986"><span md-src-pos="16895..16902"></span><span md-src-pos="16902..16905">use</span>
<span md-src-pos="16906..16974">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface;</span>
<span md-src-pos="16975..16975"></span>
<span md-src-pos="16976..16981">[...]</span>
<span md-src-pos="16982..16982"></span>
<span md-src-pos="16983..16983"></span><span md-src-pos="16983..16986"></span></code></pre>
  </div>
 </body>
</html>